{"version":3,"file":"addplant-OQLMDHch.js","sources":["../../../../frontend/src/loginService.js","../../../../frontend/src/addPlant.js"],"sourcesContent":["export default class LoginService {\r\n    isLoggedIn() {\r\n        return window.localStorage.getItem('token') !== null;\r\n    }\r\n\r\n    async login(user, password) {\r\n        const response = await fetch('/api/authentication/login', {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json'\r\n            },\r\n            body: JSON.stringify({ username: user, password: password })\r\n        });\r\n\r\n        if (response.ok) {\r\n            const data = await response.json();\r\n            window.localStorage.setItem('token', data.JWT);\r\n            return Promise.resolve();\r\n        } else {\r\n            const errorData = await response.json();\r\n            return Promise.reject(errorData.error || 'Login failed');\r\n        }\r\n    }\r\n\r\n    async getUser() {\r\n        const token = window.localStorage.getItem('token');\r\n        if (!token) return Promise.resolve(null);\r\n\r\n        const response = await fetch('/api/authentication/validate', {\r\n            method: 'GET',\r\n            headers: {\r\n                'Authorization': `Bearer ${token}`\r\n            }\r\n        });\r\n\r\n        if (response.ok) {\r\n            return response.json();\r\n        } else {\r\n            this.logout();\r\n            return Promise.resolve(null);\r\n        }\r\n    }\r\n\r\n    logout() {\r\n        window.localStorage.removeItem('token');\r\n        return Promise.resolve();\r\n    }\r\n}","import LoginService from './loginService.js';\r\n\r\nlet service = new LoginService();\r\n\r\nfunction refresh() {\r\n    if (service.isLoggedIn()) {\r\n        document.forms.login.style = \"display:none\";\r\n        document.forms.logout.style = \"display:block\";\r\n        service.getUser().then(user => {\r\n            if (user) {\r\n                document.getElementById('user').textContent = user.username;\r\n            }\r\n        });\r\n    } else {\r\n        document.forms.logout.style = \"display:none\";\r\n        document.forms.login.style = \"display:block\";\r\n    }\r\n}\r\n\r\ndocument.forms.login.addEventListener('submit', e => {\r\n    e.preventDefault();\r\n    service.login(document.forms.login.username.value, document.forms.login.password.value).then(() => {\r\n        window.location.reload();\r\n    }).catch(error => {\r\n        alert(error);\r\n    });\r\n});\r\n\r\ndocument.forms.logout.addEventListener('submit', e => {\r\n    e.preventDefault();\r\n    service.logout().then(() => {\r\n        window.location.reload();\r\n    });\r\n});\r\n\r\ndocument.getElementById(\"add-plant-form\").addEventListener(\"submit\", function(event) {\r\n    event.preventDefault();\r\n    \r\n    const plantData = {\r\n        id: document.getElementById(\"id\").value,\r\n        scientific_name: document.getElementById(\"scientific_name\").value,\r\n        description: document.getElementById(\"description\").value,\r\n        bloom_time: document.getElementById(\"bloom_time\").value,\r\n        height: document.getElementById(\"height\").value,\r\n        width: document.getElementById(\"width\").value,\r\n        sun_requirements: document.getElementById(\"sun_requirements\").value,\r\n        soil_type: document.getElementById(\"soil_type\").value,\r\n        water_needs: document.getElementById(\"water_needs\").value\r\n    };\r\n\r\n    fetch('/api/plants', {\r\n        method: 'POST',\r\n        headers: {\r\n            'Content-Type': 'application/json',\r\n            \"Authorization\": \"Bearer \" + window.localStorage.getItem(\"token\")\r\n        },\r\n        body: JSON.stringify(plantData)\r\n    })\r\n    .then(response => {\r\n        if (response.status === 201) {\r\n            return response.json();\r\n        } else if (response.status === 409) {\r\n            return response.text().then(text => { throw new Error(text); });\r\n        } else if (response.status === 403) {\r\n            return new Error(\"You are not authorized to add a plant.\");\r\n        } else {\r\n            throw new Error(\"Failed to add plant.\");\r\n        }\r\n    })\r\n    .then(data => {\r\n        document.getElementById(\"add-plant-form\").reset();\r\n    })\r\n    .catch(error => {\r\n        console.error(\"Error adding plant:\", error);\r\n        alert(error.message);\r\n    });\r\n});\r\n\r\nrefresh();\r\n\r\nservice.getUser().then(user => {\r\n    if (!user) {\r\n        service.logout();\r\n    }\r\n    refresh();\r\n});"],"names":["LoginService","user","password","response","data","errorData","token","service","refresh","e","error","event","plantData","text"],"mappings":"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"}