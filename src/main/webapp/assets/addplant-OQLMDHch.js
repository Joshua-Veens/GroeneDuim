import"./style-CrNA9BGr.js";class i{isLoggedIn(){return window.localStorage.getItem("token")!==null}async login(o,e){const r=await fetch("/api/authentication/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:o,password:e})});if(r.ok){const a=await r.json();return window.localStorage.setItem("token",a.JWT),Promise.resolve()}else{const a=await r.json();return Promise.reject(a.error||"Login failed")}}async getUser(){const o=window.localStorage.getItem("token");if(!o)return Promise.resolve(null);const e=await fetch("/api/authentication/validate",{method:"GET",headers:{Authorization:`Bearer ${o}`}});return e.ok?e.json():(this.logout(),Promise.resolve(null))}logout(){return window.localStorage.removeItem("token"),Promise.resolve()}}let n=new i;function l(){n.isLoggedIn()?(document.forms.login.style="display:none",document.forms.logout.style="display:block",n.getUser().then(t=>{t&&(document.getElementById("user").textContent=t.username)})):(document.forms.logout.style="display:none",document.forms.login.style="display:block")}document.forms.login.addEventListener("submit",t=>{t.preventDefault(),n.login(document.forms.login.username.value,document.forms.login.password.value).then(()=>{window.location.reload()}).catch(o=>{alert(o)})});document.forms.logout.addEventListener("submit",t=>{t.preventDefault(),n.logout().then(()=>{window.location.reload()})});document.getElementById("add-plant-form").addEventListener("submit",function(t){t.preventDefault();const o={id:document.getElementById("id").value,scientific_name:document.getElementById("scientific_name").value,description:document.getElementById("description").value,bloom_time:document.getElementById("bloom_time").value,height:document.getElementById("height").value,width:document.getElementById("width").value,sun_requirements:document.getElementById("sun_requirements").value,soil_type:document.getElementById("soil_type").value,water_needs:document.getElementById("water_needs").value};fetch("/api/plants",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+window.localStorage.getItem("token")},body:JSON.stringify(o)}).then(e=>{if(e.status===201)return e.json();if(e.status===409)return e.text().then(r=>{throw new Error(r)});if(e.status===403)return new Error("You are not authorized to add a plant.");throw new Error("Failed to add plant.")}).then(e=>{document.getElementById("add-plant-form").reset()}).catch(e=>{console.error("Error adding plant:",e),alert(e.message)})});l();n.getUser().then(t=>{t||n.logout(),l()});
//# sourceMappingURL=addplant-OQLMDHch.js.map
